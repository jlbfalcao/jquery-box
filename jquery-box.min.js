(function(a){var g=function(){a(".context-mask, .context").remove()};a(".context .close, .context-mask").live("click",g);a(document).keydown(function(d){d.keyCode==27&&g()});var h=function(d){switch(d){case "top":return"bottom";case "bottom":return"top";case "left":return"right";case "right":return"left"}};a.fn.contextfy=function(d){d=d||{};var i=d.afteropen||function(){};a(this).each(function(n,e){var j=a(e).data("contextTmpl"),k=a(e).data("contextPosition")||"top",l=a("#"+j);a(e).click(function(){var b=
a('<div class="context"><div class="inner"></div><div class="point"></div></div>').appendTo(document.body);b.css("zIndex",10001);var m=l.tmpl(a(this).data()).appendTo(b.children(".inner"));a('<div class="context-mask"></div>').appendTo(b.parent()).css("zIndex",1E4);var c=k.split("-"),f=c[0];c=c[1]||"center";b.addClass(f);if(f=="top"||f=="bottom"){b.position({of:a(e),my:c+" "+f,at:c+" "+h(f)});if(c=="center")b.children(".point").css("left",parseInt(b.width()/2-10));else if(c=="right")b.children(".point").css("right",
a(e).outerWidth()/2-10);else c=="left"&&b.children(".point").css("left",a(e).outerWidth()/2-10)}else{b.position({of:a(e),my:f+" center",at:h(f)+" center"});b.children(".point").css("top",parseInt(b.height()/2-10))}i(m)})})}})(jQuery);$(function(){$("*[data-context-tmpl]").contextfy()});
